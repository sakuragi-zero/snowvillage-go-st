# é–‹ç™ºè€…å‘ã‘æ‰‹é †æ›¸ - PostgreSQL + DevContainerç’°å¢ƒ

## æ¦‚è¦
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯DevContainerç’°å¢ƒã§PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ãŸé–‹ç™ºã‚’è¡Œã„ã¾ã™ã€‚  
DevContainerèµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã‚‚èµ·å‹•ã•ã‚Œã€é–‹ç™ºã«å¿…è¦ãªç’°å¢ƒãŒæ•´ã„ã¾ã™ã€‚

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. å‰ææ¡ä»¶
- Visual Studio Code
- Docker Desktop
- Dev Containersæ‹¡å¼µæ©Ÿèƒ½

### 2. é–‹ç™ºç’°å¢ƒã®èµ·å‹•

#### 2.1 DevContainerã‚’é–‹ã
1. VSCodeã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
2. `Ctrl+Shift+P` (Mac: `Cmd+Shift+P`) ã§ã‚³ãƒžãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é–‹ã
3. `Dev Containers: Reopen in Container` ã‚’é¸æŠž
4. åˆå›žã¯æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ãŒã€PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã¨é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠãŒè‡ªå‹•èµ·å‹•ã—ã¾ã™

#### 2.2 ç’°å¢ƒã®ç¢ºèª
```bash
# PostgreSQLæŽ¥ç¶šç¢ºèª
echo "DBæŽ¥ç¶šå…ˆ: $DB_HOST:$DB_PORT"
echo "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: $DB_NAME"

# è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç–Žé€šç¢ºèªï¼ˆæŽ¨å¥¨ï¼‰
cd app
uv run python ../db_connection_test.py
```

**ç°¡æ˜“æŽ¥ç¶šãƒ†ã‚¹ãƒˆ**
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆé–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œï¼‰
python -c "
import psycopg2
import os
try:
    conn = psycopg2.connect(
        host=os.getenv('DB_HOST'),
        database=os.getenv('DB_NAME'),
        user=os.getenv('DB_USER'),
        password=os.getenv('DB_PASSWORD'),
        port=os.getenv('DB_PORT')
    )
    print('âœ… PostgreSQLæŽ¥ç¶šæˆåŠŸ')
    conn.close()
except Exception as e:
    print(f'âŒ PostgreSQLæŽ¥ç¶šå¤±æ•—: {e}')
"
```

## é–‹ç™ºä½œæ¥­ã®æµã‚Œ

### 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º

#### 3.1 ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
cd app
pip install uv
uv sync
```

#### 3.2 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
```bash
cd app
uv run python -m streamlit run launch_screen.py
```

**æ³¨æ„**: `uv run streamlit run`ã‚³ãƒžãƒ³ãƒ‰ã¯å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¿…ãš`uv run python -m streamlit run`å½¢å¼ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `http://localhost:8501` ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

#### 3.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
åˆå›žèµ·å‹•æ™‚ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã¯è‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ã€‚  
æ—¢å­˜ã®SQLiteãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã™ã‚‹å ´åˆï¼š

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
python migrate_sqlite_to_postgres.py
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ

#### 4.1 PostgreSQLæŽ¥ç¶šæƒ…å ±ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
- **ãƒ›ã‚¹ãƒˆ**: postgres-dev
- **ãƒãƒ¼ãƒˆ**: 5432  
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å**: snowvillage
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼å**: postgres
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: devpassword

#### 4.2 psqlã§ã®ç›´æŽ¥æŽ¥ç¶š
```bash
# DevContainerå†…ã‹ã‚‰
psql -h postgres-dev -U postgres -d snowvillage

# ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ï¼ˆãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰çµŒç”±ï¼‰
psql -h localhost -U postgres -d snowvillage -p 5432
```

#### 4.3 ã‚ˆãä½¿ã†SQL
```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
SELECT * FROM users ORDER BY created_at DESC;

-- ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª
\d users

-- ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ç¢ºèª  
SELECT COUNT(*) FROM users;
```

### 5. ãƒ‡ãƒãƒƒã‚°ã¨ãƒ†ã‚¹ãƒˆ

#### 5.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç–Žé€šç¢ºèª
```bash
# åŒ…æ‹¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ã‚¹ãƒ†ã‚¹ãƒˆ
cd app
uv run python ../db_connection_test.py

# å‡ºåŠ›ä¾‹:
# === ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç–Žé€šç¢ºèª ===
# ãƒ†ã‚¹ãƒˆé–‹å§‹æ™‚åˆ»: 2025-08-09 02:33:45.376455
# æŽ¥ç¶šå…ˆ: postgres-dev:5432
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: snowvillage
# ãƒ¦ãƒ¼ã‚¶ãƒ¼: postgres
# ----------------------------------------
# 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šãƒ†ã‚¹ãƒˆ...
#    âœ“ æŽ¥ç¶šæˆåŠŸ
#    PostgreSQLãƒãƒ¼ã‚¸ãƒ§ãƒ³: PostgreSQL 15.13 
#    ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¾åœ¨æ™‚åˆ»: 2025-08-09 02:33:45.381255+00:00
# 
# 2. ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ç¢ºèª...
#    âœ“ æ¤œå‡ºã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«æ•°: 1
#    - users
# 
# 3. usersãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°ç¢ºèª...
#    âœ“ ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: 5
#    æœ€æ–°ã®ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆæœ€å¤§5ä»¶ï¼‰:
#    - testuser (ç™»éŒ²: 2025-08-09 01:15:30, æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³: 2025-08-09 02:10:15)
# ----------------------------------------
# âœ“ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç–Žé€šç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸ
```

#### 5.2 ãƒ­ã‚°ç¢ºèª
```bash
# PostgreSQLãƒ­ã‚°ç¢ºèª
docker compose -f docker-compose.dev.yml logs postgres-dev

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯é€šå¸¸ã®Pythonãƒ‡ãƒãƒƒã‚°ãŒå¯èƒ½
```

#### 5.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
```bash
# PostgreSQLé–‹ç™ºãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
docker compose -f docker-compose.dev.yml down -v
docker compose -f docker-compose.dev.yml up -d postgres-dev
```

### 6. ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã¨ã®é•ã„

| é …ç›® | é–‹ç™ºç’°å¢ƒ | ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒ |
|------|----------|-------------------|
| compose file | docker-compose.dev.yml | docker-compose.yml |
| DB password | devpassword | password |
| DB container name | postgres-dev | snowvillage-postgres |
| èµ·å‹•æ–¹æ³• | DevContainerè‡ªå‹• | æ‰‹å‹• `docker compose up` |

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: PostgreSQLæŽ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# PostgreSQLã‚³ãƒ³ãƒ†ãƒŠçŠ¶æ…‹ç¢ºèª
docker compose -f docker-compose.dev.yml ps

# PostgreSQLã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•
docker compose -f docker-compose.dev.yml restart postgres-dev
```

### å•é¡Œ2: DevContainerèµ·å‹•å¤±æ•—
1. Docker DesktopãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. `.devcontainer.json` ã®è¨­å®šç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¦å†æ§‹ç¯‰

### å•é¡Œ3: ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆ
æ—¢ã«ãƒãƒ¼ãƒˆ5432ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼š
```yaml
# docker-compose.dev.yml ã® postgres-dev ã‚µãƒ¼ãƒ“ã‚¹
ports:
  - "5433:5432"  # åˆ¥ã®ãƒãƒ¼ãƒˆã«å¤‰æ›´
```

### å•é¡Œ4: ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹
é–‹ç™ºãƒ‡ãƒ¼ã‚¿ãŒé‡è¦ãªå ´åˆï¼š
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
docker compose -f docker-compose.dev.yml exec postgres-dev pg_dump -U postgres snowvillage > backup.sql

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢  
docker compose -f docker-compose.dev.yml exec -T postgres-dev psql -U postgres snowvillage < backup.sql
```

## ä¾¿åˆ©ãªVSCodeè¨­å®š

### settings.json ã«è¿½åŠ æŽ¨å¥¨
```json
{
  "python.defaultInterpreterPath": "/usr/local/bin/python",
  "python.terminal.activateEnvironment": true,
  "files.autoSave": "afterDelay",
  "files.autoSaveDelay": 1000
}
```

## ã‚³ãƒŸãƒƒãƒˆå‰ã®ãƒã‚§ãƒƒã‚¯

```bash
# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆé–‹ç™ºç’°å¢ƒã§å®Ÿè¡Œï¼‰
cd app
uv run black .
uv run flake8 .
uv run mypy .

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆï¼‰
uv run pytest
```

---

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ä¸€è¦§

### 7. é€²æ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

#### 7.1 ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã®ã‚¿ã‚¹ã‚¯é€²æ—ç®¡ç†
- ã‚¯ã‚¤ã‚ºå½¢å¼ã¨SNSæŠ•ç¨¿å½¢å¼ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³
- YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯å®šç¾©

#### 7.2 é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- **`app/task_db.py`**: ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
- **`app/tasks.py`**: YAMLãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸæ©Ÿèƒ½
- **`app/tasks.yml`**: ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«
- **`app/pages/dashboard.py`**: ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

#### 7.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒž
```sql
-- ã‚¿ã‚¹ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    task_type TEXT DEFAULT 'basic',  -- quiz, sns, basic
    description TEXT,
    content JSONB  -- ã‚¯ã‚¤ã‚ºå•é¡Œã‚„SNSè¦ä»¶
);

-- é€²æ—ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼Ã—ã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ³ï¼‰
CREATE TABLE progress (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    task_id INT NOT NULL,
    completed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (task_id) REFERENCES tasks(id),
    UNIQUE(user_id, task_id)
);
```

#### 7.4 ã‚¿ã‚¹ã‚¯å®šç¾©å½¢å¼ï¼ˆtasks.ymlï¼‰
```yaml
# ã‚¯ã‚¤ã‚ºã‚¿ã‚¹ã‚¯ä¾‹
- id: 1
  title: "ãƒ‡ãƒ¼ã‚¿å–å¾—æŠ€è¡“"
  type: "quiz"
  description: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã«é–¢ã™ã‚‹æŠ€è¡“ã‚¯ã‚¤ã‚ºã§ã™"
  content:
    question: "SQLã§ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã¯ï¼Ÿ"
    options:
      - "SELECT * FROM table_name"
      - "GET ALL FROM table_name"
    correct_answer: 0

# SNSã‚¿ã‚¹ã‚¯ä¾‹
- id: 2
  title: "AIãƒ»MLãƒ–ãƒ¼ã‚¹ã‚’è¨ªå•"
  type: "sns"
  description: "AIãƒ»MLãƒ–ãƒ¼ã‚¹ã‚’è¨ªå•ã—ã¦SNSã«æŠ•ç¨¿ã—ã‚ˆã†ï¼"
  content:
    booth_name: "AIãƒ»MLãƒ†ã‚¯ãƒŽãƒ­ã‚¸ãƒ¼ãƒ–ãƒ¼ã‚¹"
    sns_prompt: "AIãƒ»MLãƒ–ãƒ¼ã‚¹ã§æœ€æ–°æŠ€è¡“ã‚’ä½“é¨“ä¸­ï¼ #SnowVillage"
    requirements:
      - "ãƒ–ãƒ¼ã‚¹ã‚¹ã‚¿ãƒƒãƒ•ã¨å†™çœŸã‚’æ’®ã‚‹"
      - "ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚° #SnowVillage ã‚’å«ã‚ã‚‹"
```

#### 7.5 APIä½¿ç”¨æ–¹æ³•
```python
from task_db import TaskService

# ã‚¿ã‚¹ã‚¯ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–
task_service = TaskService()

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§å–å¾—
tasks = task_service.get_tasks_with_progress(user_id)

# ã‚¿ã‚¹ã‚¯å®Œäº†ãƒžãƒ¼ã‚¯
task_service.mark_task_complete(task_id, user_id)

# YAMLã‹ã‚‰ã‚¿ã‚¹ã‚¯åŒæœŸ
from tasks import sync_yaml_to_db
sync_yaml_to_db("tasks.yml")
```

### 8. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

#### 8.1 ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ã‚¹ã‚¯å®Œäº†æ•°ã«åŸºã¥ããƒ©ãƒ³ã‚­ãƒ³ã‚°
- åŒã˜å®Œäº†æ•°ã®å ´åˆã¯åˆå›žå®Œäº†æ—¥æ™‚ã§é †ä½æ±ºå®š
- ä¸Šä½10ä½ã¾ã§ã®è¡¨ç¤º

#### 8.2 é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- **`app/pages/ranking.py`**: ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºãƒšãƒ¼ã‚¸
- **`app/task_db.py`**: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¯ã‚¨ãƒªæ©Ÿèƒ½

#### 8.3 ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
```python
def get_user_ranking(self):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ã‚¹ã‚¯å®Œäº†æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’å–å¾—ï¼ˆä¸Šä½10ä½ï¼‰"""
    query = """
        SELECT u.username, 
               COUNT(p.task_id) as completed_tasks,
               MIN(p.completed_at) as first_completion
        FROM users u
        LEFT JOIN progress p ON u.id = p.user_id
        GROUP BY u.id, u.username
        ORDER BY completed_tasks DESC, first_completion ASC NULLS LAST
        LIMIT 10
    """
```

#### 8.4 ãƒšãƒ¼ã‚¸é·ç§»
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** â†” **ãƒ©ãƒ³ã‚­ãƒ³ã‚°** â†” **åŒ¿åæŠ•ç¨¿**
- ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã§çµ±ä¸€

### 9. Slack Bot åŒ¿åæŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ 

#### 9.1 ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- å®Œå…¨åŒ¿åã§ã®Slackãƒãƒ£ãƒ³ãƒãƒ«æŠ•ç¨¿
- é€ä¿¡æ™‚åˆ»ã®è‡ªå‹•ä»˜ä¸Ž
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨æŽ¥ç¶šãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

#### 9.2 é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- **`app/slack_client.py`**: Slack API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- **`app/pages/post.py`**: åŒ¿åæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ 
- **`app/.streamlit/secrets.toml`**: Slackèªè¨¼è¨­å®š

#### 9.3 Slackè¨­å®šæ‰‹é †
```bash
# 1. secrets.tomlãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
mkdir -p app/.streamlit
cat > app/.streamlit/secrets.toml << 'EOF'
[slack]
bot_token = "xoxb-your-bot-token-here"
channel_id = "C0123456789"
bot_name = "Snow Village Bot"
EOF

# 2. Slack Appä½œæˆæ‰‹é †
# - https://api.slack.com/apps ã§Slack Appã‚’ä½œæˆ
# - OAuth & Permissions ã§ chat:write ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ 
# - Install App to Workspace ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
# - ãƒãƒ£ãƒ³ãƒãƒ«ã«Botã‚’æ‹›å¾…: /invite @your_bot_name
```

#### 9.4 APIä½¿ç”¨æ–¹æ³•
```python
from slack_client import SlackClient

# Slackã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
slack_client = SlackClient()

# è¨­å®šç¢ºèª
if slack_client.is_configured():
    # åŒ¿åãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    success, message = slack_client.send_anonymous_message(
        message="ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
        username="user123"  # ãƒ­ã‚°ç”¨ï¼ˆSlackã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼‰
    )
    
    # æŽ¥ç¶šãƒ†ã‚¹ãƒˆ
    success, result = slack_client.test_connection()
```

#### 9.5 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ
```
ðŸ”ï¸ **Snow Village åŒ¿åæŠ•ç¨¿**

ðŸ“ **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹

ðŸ• **æŠ•ç¨¿æ™‚åˆ»:** 2025å¹´8æœˆ17æ—¥ 12:34:56
ðŸ‘¤ **æŠ•ç¨¿è€…:** åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼
```

### 10. é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒžãƒ³ãƒ‰

#### 10.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆusersãƒ†ãƒ¼ãƒ–ãƒ«ä»¥å¤–å‰Šé™¤ï¼‰
cd app
uv run python ../db_cleanup.py

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
uv run python ../db_connection_test.py

# TaskServiceæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
uv run python -c "
from task_db import TaskService
ts = TaskService()
print('TaskService initialized successfully')
ranking = ts.get_user_ranking()
print(f'Current ranking: {len(ranking)} users')
"
```

#### 10.2 Slackæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
```bash
# Slackè¨­å®šç¢ºèª
cd app
uv run python -c "
from slack_client import SlackClient
client = SlackClient()
print(f'Slack configured: {client.is_configured()}')
if client.is_configured():
    success, msg = client.test_connection()
    print(f'Connection test: {success} - {msg}')
"
```

#### 10.3 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
```bash
# é–‹ç™ºç’°å¢ƒã§ã®èµ·å‹•
cd app
uv run streamlit run main.py

# ç‰¹å®šãƒãƒ¼ãƒˆã§ã®èµ·å‹•
uv run streamlit run main.py --server.port 8502

# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
uv run streamlit run main.py --server.headless true
```

### 11. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
app/
â”œâ”€â”€ main.py                    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ launch_screen.py           # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
â”œâ”€â”€ user.py                    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
â”œâ”€â”€ task_db.py                 # ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
â”œâ”€â”€ tasks.py                   # YAMLåŒæœŸæ©Ÿèƒ½
â”œâ”€â”€ tasks.yml                  # ã‚¿ã‚¹ã‚¯å®šç¾©
â”œâ”€â”€ slack_client.py            # Slack API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ dashboard.py           # ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ ranking.py             # ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ post.py                # åŒ¿åæŠ•ç¨¿ãƒšãƒ¼ã‚¸
â”œâ”€â”€ frontend/public/           # é™çš„ãƒªã‚½ãƒ¼ã‚¹
â”œâ”€â”€ .streamlit/
â”‚   â””â”€â”€ secrets.toml           # Slackèªè¨¼è¨­å®š
â””â”€â”€ pyproject.toml             # Pythonä¾å­˜é–¢ä¿‚
```

### 12. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæ©Ÿèƒ½åˆ¥ï¼‰

#### 12.1 ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¨ãƒ©ãƒ¼
```bash
# ã‚¿ã‚¹ã‚¯ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ
cd app
uv run python -c "
from tasks import sync_yaml_to_db
sync_yaml_to_db('tasks.yml')
print('Tasks synced from YAML')
"

# ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚¨ãƒ©ãƒ¼ã®å ´åˆ
# dashboard.pyã§get_tasks_with_progress(user_id)ã«user_idãŒæ­£ã—ãæ¸¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
```

#### 12.2 ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºã‚¨ãƒ©ãƒ¼
```bash
# ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ç¢ºèª
cd app
uv run python -c "
from task_db import TaskService
ts = TaskService()
ranking = ts.get_user_ranking()
for i, rank in enumerate(ranking, 1):
    print(f'{i}. {rank[\"username\"]}: {rank[\"completed_tasks\"]} tasks')
"
```

#### 12.3 SlackæŠ•ç¨¿ã‚¨ãƒ©ãƒ¼
```bash
# ä¸€èˆ¬çš„ãªSlackã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•
# "channel_not_found" â†’ ãƒãƒ£ãƒ³ãƒãƒ«IDã‚’ç¢ºèª
# "not_in_channel" â†’ ãƒœãƒƒãƒˆã‚’ãƒãƒ£ãƒ³ãƒãƒ«ã«æ‹›å¾…
# "invalid_auth" â†’ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†ç¢ºèª

# è©³ç´°ãƒ­ã‚°ç¢ºèª
cd app
uv run python -c "
import logging
logging.basicConfig(level=logging.DEBUG)
from slack_client import SlackClient
client = SlackClient()
success, msg = client.send_anonymous_message('test message')
print(f'Result: {success} - {msg}')
"
```

---

ã“ã®ç’°å¢ƒã«ã‚ˆã‚Šã€PostgreSQLã‚’ä½¿ç”¨ã—ãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯é–‹ç™ºãŒDevContainerå†…ã§å®Œçµã—ã¾ã™ã€‚é€²æ—ç®¡ç†ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€Slacké€£æºæ©Ÿèƒ½ãŒçµ±åˆã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚